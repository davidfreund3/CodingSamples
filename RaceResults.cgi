#!/usr/bin/perl -w
use CGI qw(:standard);use DBI;
$PhotoSrc = "www.drizzle.com/~davidf/";
# set parameter variables:$Year = param("txtYear");$BibNumber = param("txtBibNumber");$Offset = param("Offset") || 0;$OffsetDec = $Offset - 1;$OffsetInc = $Offset + 1;
# set database handles:$Driver = "mysql";$Hostname = "bert.speakeasy.net";$Port = "3306";$User = "pumpkinpull";$Password = "brickbats";$Database = "pumpkinpush";
$DSN = "DBI:$Driver:database=$Database;host=$Hostname;port=$Port"; # Data Source Name string$Connection = DBI->connect($DSN, $User, $Password); # Connect to database$RS = $Connection->prepare("SELECT * FROM tblResults WHERE Year = $Year AND RaceNumber = $BibNumber"); # $RS aka Recordset aka statement handle$RS->execute();
$FieldRef = $RS->fetchrow_hashref(); # field value hash ref
if ($Offset == 0) {	$RequestedPhotoFileName = $FieldRef->{'Photo'};} else {	$RSPhoto = $Connection->prepare("SELECT * FROM tblPhoto WHERE FileName = '$FieldRef->{'Photo'}'"); # get photo primary key	$RSPhoto->execute();	$FieldRefPhoto = $RSPhoto->fetchrow_hashref(); 	$RequestedPhotoPK = $FieldRefPhoto->{"idPhoto"}+$Offset;	$RSPhoto->finish();	$RSPhoto = $Connection->prepare("SELECT * FROM tblPhoto WHERE idPhoto = '$RequestedPhotoPK'"); # get photo primary key	$RSPhoto->execute();	$FieldRefPhoto = $RSPhoto->fetchrow_hashref(); 	$RequestedPhotoFileName = $FieldRefPhoto->{'FileName'};	$RSPhoto->finish();}print <<EOF;Content-type: text/html<html><head>	<title> 1999 Pumpkin Push: Results </title>	<meta name="Author" content="Pumpkin Push">	<meta name="description" content="Race Times and Finish Photos">	<meta name="keywords" content="Pumpkin Push, pumpkins, pumpkin, race, walk, clinics, fun-run, fun run,		10k, 4k, 10-k, 4-k, 3-mile, benefit, benefits, costume, costumes, running, runs, clinic, walks, jog, jogging,		45th St. Clinic, racing, athlete, athletics, fun, exercise, October 31, 1999, 31st, Sunday, October, mile		University of Washington, UW, Gasworks Park, events, event, Gasworks, park, Seattle, competition, three		aerobic, competitions, health care, homeless, homelessness, charity, volunteer, charities, health, 3,		insurance, health insurance, poor, poverty, T-shirt, tee-shirt, free T-shirt, free tee-shirt, Halloween,		Danskin, Walk-America, Race For The Cure, PAWSWALK, Bay-To-Breakers, marathon, Seattle Marathon, dress up,		Salmon Days, DAWG Dash, Shore Run, Swedish Summer Run, Swedish, Cancer, AIDS Walk, Washington, Wallingford,		pumpkinpush.org, racecenter.com, pumpkinpush.com, ontherun.com, family, youth, costume, dress-up, costumes,		Super Jock 'n Jill, Fast Lady Sports, FootZone, Nike, Addidas, shoes, Etonic, New Balance, Saucony, Asics"></head><body 	leftmargin=0 	topmargin=0 	marginwidth=0 	marginheight=0 	background="images/background.gif" 	bgcolor="White" 	text="Black" 	link="Blue" 	vlink="Purple" 	alink="Red">	<table border=0 cellspacing=0 cellpadding=0>		<tr valign=top>			<td rowspan=2><a href="http://pumpkinpush.org">				<img src="images/headerleft.jpg" border=0 alt="Take me home, Daddy-o!" width=145 height=117></a></td>			<td><img src="images/headermiddleresults.jpg" border=0 alt="Race Results" width=379 height=84></td>			<td><img src="images/headerright.jpg" border=0 alt="Awoooooo!" width=84 height=84></td>			</tr>		<tr>			<td colspan=2></td>		</tr>		<tr valign="top">			<td><table border=0 cellspacing=0 cellpadding=0>				<tr>					<td align="left"><a	href="clinic.html" 						onmouseover="imgbuttonclinic.src='images/buttonclinicon.jpg'" 						onmouseout="imgbuttonclinic.src='images/buttonclinicoff.jpg'">							<img name="imgbuttonclinic" 								src="images/buttonclinicoff.jpg" 								border=0 								alt="45th Street clinic"								width=118								height=24></a></td>				</tr>				<tr>					<td align="left"><a	href="course.html" 						onmouseover="imgbuttoncourse.src='images/buttoncourseon.jpg'" 						onmouseout="imgbuttoncourse.src='images/buttoncourseoff.jpg'">							<img name="imgbuttoncourse" 								src="images/buttoncourseoff.jpg" 								border=0 								alt="Course Map"								width=118								height=24></a></td>				</tr>				<tr>					<td align="left"><a	href="raceday.html" 						onmouseover="imgbuttonraceday.src='images/buttonracedayon.jpg'" 						onmouseout="imgbuttonraceday.src='images/buttonracedayoff.jpg'">							<img name="imgbuttonraceday" 								src="images/buttonracedayoff.jpg" 								border=0 								alt="Race Day Details"								width=118								height=24></a></td>				</tr>				<tr>					<td align="left"><a	href="tshirt.html" 						onmouseover="imgbuttontshirt.src='images/buttontshirton.jpg'" 						onmouseout="imgbuttontshirt.src='images/buttontshirtoff.jpg'">							<img name="imgbuttontshirt" 								src="images/buttontshirtoff.jpg" 								border=0 								alt="T-Shirt"								width=118								height=24></a></td>				</tr>				<tr>					<td align="left"><a	href="registration.html" 						onmouseover="imgbuttonregistration.src='images/buttonregistrationon.jpg'" 						onmouseout="imgbuttonregistration.src='images/buttonregistrationoff.jpg'">							<img name="imgbuttonregistration" 								src="images/buttonregistrationoff.jpg" 								border=0 								alt="Registration"								width=118								height=24></a></td>				</tr>				<tr>					<td align="left"><a	href="pumpkinpatch.html" 						onmouseover="imgbuttonpumpkinpatch.src='images/buttonpumpkinpatchon.jpg'" 						onmouseout="imgbuttonpumpkinpatch.src='images/buttonpumpkinpatchoff.jpg'">							<img name="imgbuttonpumpkinpatch" 								src="images/buttonpumpkinpatchoff.jpg" 								border=0 								alt="Pumpkin Patch"								width=118								height=24></a></td>				</tr>				<tr>					<td align="left"><a	href="photos.html" 						onmouseover="imgbuttonphotos.src='images/buttonphotoson.jpg'" 						onmouseout="imgbuttonphotos.src='images/buttonphotosoff.jpg'">							<img name="imgbuttonphotos" 								src="images/buttonphotosoff.jpg" 								border=0 								alt="Last Year's Photos"								width=118								height=24></a></td>				</tr>				<tr>					<td align="left"><a	href="results.html" 						onmouseover="imgbuttonresults.src='images/buttonresultson.jpg'" 						onmouseout="imgbuttonresults.src='images/buttonresultson.jpg'">							<img name="imgbuttonresults" 								src="images/buttonresultson.jpg" 								border=0 								alt="Race Results"								width=118								height=24></a></td>				</tr>				<tr>					<td align="center">						<br>						<br>						<font size=-2><i><b>Photos made possible by:</b></i></font><p>						<a href="http://www.drizzle.com"><img src="images/drizzle.jpg" border=0 alt="Drizzle Internet" width=115 height=37></a>						<br>					</td>				</tr>			</table></td>			<td width=463 colspan=2>				<table border=0 cellspacing=0 cellpadding=5 bgcolor="#ccccff">					<tr>						<td colspan=2>							<font size=+2 face="Arial,Helvetica"><b>								#$FieldRef->{'RaceNumber'}								$FieldRef->{'NameFirst'}								$FieldRef->{'NameLast'}							</b></font>							<font face="Arial,Helvetica">							of $FieldRef->{'HomeTown'}							</font>						</td>					</tr>					<tr>						<td valign="top">							<table border=0 cellspacing=0 cellpadding=0 bgcolor="Black">								<tr>									<td colspan=2>										<img border=0 src="http://$PhotoSrc$RequestedPhotoFileName" height=240 width=320><br>									</td>								</tr>								<tr>									<td valign="top" align="left">										<a href="results.cgi?txtYear=$FieldRef->{'Year'}&txtBibNumber=$FieldRef->{'RaceNumber'}&Offset=$OffsetDec">											<font size=-1 face="Arial,Helvetica" color="yellow">												<- 1 second earlier											</font> 										</a>									</td>									<td valign="top" align="right">										<a href="results.cgi?txtYear=$FieldRef->{'Year'}&txtBibNumber=$FieldRef->{'RaceNumber'}&Offset=$OffsetInc">											<font size=-1 face="Arial,Helvetica" color="yellow">												1 second later ->											</font>										</a>									</td>								</tr>							</table>						</td>						<td>							<font size=-2 face="Arial,Helvetica">$FieldRef->{'Year'} $FieldRef->{'Course'} Time:<br></font>							<font face="Arial,Helvetica">$FieldRef->{'GunTime'}<p></font>							<font size=-2 face="Arial,Helvetica">Pace:<br></font>							<font face="Arial,Helvetica">$FieldRef->{'Pace'} min/mile<p></font>							<font size=-2 face="Arial,Helvetica">Place Overall:<br></font>							<a href="overall.cgi?txtYear=$Year&txtBibNumber=$BibNumber&txtCourse=$FieldRef->{'Course'}&VIPName=$FieldRef->{'NameFirst'}">								<font face="Arial,Helvetica">$FieldRef->{'OverallPlace'} out of $FieldRef->{'OverallTotal'}<p></font>							</a>							<font size=-2 face="Arial,Helvetica">w/in Division ($FieldRef->{'Gender'} $FieldRef->{'Division'}):<br></font>							<a href="division.cgi?txtYear=$Year&txtBibNumber=$BibNumber">								<font face="Arial,Helvetica">$FieldRef->{'DivisionPlace'} out of $FieldRef->{'DivisionTotal'}<p></font>							</a>							<font size=-2 face="Arial,Helvetica">w/in Gender:<br></font>							<font face="Arial,Helvetica">$FieldRef->{'GenderPlace'} out of $FieldRef->{'GenderTotal'}</font>						</td>					</tr>				</table>			</td>		<tr valign="top">			<td><table border=0 cellspacing=0 cellpadding=0>				<tr>					<td align="left"><a	href="credits.html" 						onmouseover="imgbuttoncredits.src='images/buttoncreditson.jpg'" 						onmouseout="imgbuttoncredits.src='images/buttoncreditsoff.jpg'">							<img name="imgbuttoncredits" 								src="images/buttoncreditsoff.jpg" 								border=0 								alt="Credits"								width=118								height=24></a></td>				</tr>			</table></td>		</tr>	</table>	<br></body></html>EOF$RS->finish();